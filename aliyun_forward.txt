# Through iptables (tcp & udp)
sysctl -w net.ipv4.ip_forward=1
iptables -t nat -A PREROUTING -p tcp --dport aliyun_port -j DNAT --to-destination vps_ip:port
iptables -t nat -A PREROUTING -p udp --dport aliyun_port -j DNAT --to-destination vps_ip:port
iptables -t nat -A POSTROUTING -p tcp -d vps_ip --dport vps_port -j SNAT --to-source aliyun_ip
iptables -t nat -A POSTROUTING -p udp -d vps_ip --dport vps_port -j SNAT --to-source aliyun_ip

# Through haproxy (tcp only)
yum install haproxy
vim /etc/haproxy/haproxy.cfg
# Start
global
        ulimit-n 51200

defaults
        log global
        mode tcp
        option dontlognull
        timeout connect 10000
        timeout client 150000
        timeout server 150000

frontend ss-in
        bind *:aliyun_port
        default_backend ss-out

backend ss-out
        balance roundrobin
        server server1 vps_ip:port maxconn 20480
        server server2 vps_ip:port maxconn 20480
        
frontend oc-in
        bind *:aliyun_port
        default_backend oc-out

backend oc-out
        balance roundrobin
        server server1 vps_ip:port maxconn 20480
        server server2 vps_ip:port maxconn 20480
# End

service haproxy start

# iptables command
iptables -t nat -vnL PREROUTING --line-number   // Show rules
iptables -t nat -vnL POSTROUTING --line-number
iptables -t nat -D POSTROUTING 1                // Delete rules
