yum -y update
yum -y install epel-release

cd /home/
wget https://raw.githubusercontent.com/henrylethe/Self-Bak-Shell/master/shadowsocks.sh
chmod +x shadowsocks.sh
./shadowsocks.sh 2>&1 | tee shadowsocks.log

vim /etc/shadowsocks-libev/config.json
# Start
{
    "server":["[::0]","0.0.0.0"],
    "server_port":22,
    "local_address":"127.0.0.1",
    "local_port":1080,
    "password":"your password",
    "timeout":600,
    "method":"aes-256-cfb"
}
# End

# Just for update
# ./shadowsocks.sh uninstall 

mkdir /home/kcptun
cd /home/kcptun
# Find packet url: https://github.com/xtaci/kcptun/releases/latest
# wget https://github.com/xtaci/kcptun/releases/download/v20161031/kcptun-linux-amd64-*.tar.gz
tar -zxf kcptun-linux-amd64-*.tar.gz

vim /etc/kcptun_config.json
# Start
{
    "listen": ":port",
    "target": "127.0.0.1:port",
    "key": "test",
    "crypt": "aes",
    "mode": "manual",
    "mtu": 1400,
    "sndwnd": 2048,
    "rcvwnd": 2048,
    "datashard": 70,
    "parityshard": 30,
    "dscp": 46,
    "nocomp": true,
    "acknodelay": false,
    "nodelay": 0,
    "interval": 40,
    "resend": 0,
    "nc": 1,
    "sockbuf": 4194304,
    "keepalive": 10
}
# End

vim /etc/supervisord.conf
# Start
[program:shadowsocks]
command=ss-server -c /etc/shadowsocks-libev/config.json -u
autostart=true
autorestart=true
user=root
stdout_logfile=/var/log/supervisor/shadowsocks_out.log
stderr_logfile=/var/log/supervisor/shadowsocks_err.log
stdout_logfile_backups=0
stderr_logfile_backups=0

[program:kcptun]
command=/home/kcptun/server_linux_amd64 -c /etc/kcptun_config.json
autostart=true
autorestart=true
user=root
stdout_logfile=/var/log/supervisor/kcptun_out.log
stdout_logfile=/var/log/supervisor/kcptun_err.log
stdout_logfile_backups=0
stderr_logfile_backups=0
# End

vim /etc/rc.local
# Start
supervisord -c /etc/supervisord.conf
# End

chmod +x /etc/rc.local
sysctl -w net.ipv4.ip_forward=1
echo net.ipv4.ip_forward = 1 >> "/etc/sysctl.conf"
systemctl daemon-reload
reboot
